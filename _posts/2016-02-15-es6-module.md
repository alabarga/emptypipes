---
layout: post
title:  "ES6 modules using Webpack and Gulp"
description: ""
tags: javascript es6
---

### Overview

I've recently begun working on more and more javascript projects. This has made
it easy to create applications that are publicly available through web pages. 
At the same time, it has required a lot of learning and trial and error to
approximate the modularity that I've grown accustomed to while using python.

One of the most common scenarios I run into is the following.

1. I start working on some application (let's call it `foo`).

2. I start working on a different program (let's call it `bar`) and need some
of the functionality that I already implemented in `foo`. 

In python, accomplishing this is trivial by simply placing them in the same
directory and saying `import foo`. In javascript, it's a little more
complicated. Rather than recapitulate a lot of existing documentation about the
different ways that one can implement modules in javascript (CommonJS, AMD,
etc...), I'll just dive into how I use `gulp` and `webpack` to take advantage
of the ECMAScript 6 syntax for modules to create reusable javascript
components.

#### Setting up `foo`

The first section involves setting up the first component, `foo`. The directory
structure of this component will be organized so that the configuration files
are in the root directory, all of the code will be in the `app` subdirectory,
unit tests will be in `test` and compiled javascript will be in `test`:

* gulpfile.babel.js
* webpack.config.js
* package.json
* bower.json
* app
    * index.html
    * scripts/foo.js
    * scripts/foo_helper.js
    * styles/foo.css
* test
    * foo_test.js
* dist
    * index.html
    * scripts
        * foo.js


#### Things to change

There are parts of the scaffolding that are specific to `mymodule`. If you want
to implement a script with a different name, you need to change the following:

* Rename `app/scripts/mymodule.js`
* All occurences of `mymodule` in `app/index.html`
* Change the `entry` line in `webpack.config.js`



I've recently been working on making our RNA drawing javascript component more
modular. Having a small simple project afforded me the opportunity to refactor
and organize it such that it can easily be used by and imported into other
projects. Before diving into the organization and configuration details, I
want to briefly mention what exactly it is that I am trying to accomplish.

On the one hand, I have a simple javascript component, called
[fornac](https://github.com/pkerpedjiev/fornac), which renders diagrams of
RNA molecules. It is simple, easy to use, and can be painlessly embedded
into a web page:

# insert image of fornac container

```
    <link rel='stylesheet' type='text/css' href='styles/fornac.css' />
    <script type='text/javascript' src='scripts/fornac.js'></script>
    <script type='text/javascript'>
        var container = new FornaContainer("#rna_ss", {'applyForce': false});

        var options = {'structure': '((..((....)).(((....))).))',
                        'sequence': 'CGCUUCAUAUAAUCCUAAUGACCUAU'
        };

        container.addRNA(options.structure, options);
    </script>
```

### The package consumer (Dr. Forna)

What if, however, I wish to use this container in a more complex application?
[Dr. Forna](https://github.com/pkerpedjiev/drforna) is a web application which
pieces together different individual RNA diagrams and arranges them into a 
treemap layout:

# insert image of Dr. Forna

I would like to be able to import `fornac` into `Dr. Forna`, while maintaining
it as its own individual repository. Before ECMAScript 6, there were at least
two different methods ofr exporting javscript modules: CommonJS and AMD, along
with other tools for dynamically loading scripts whenever they were needed
(e.g. Require.js). In ECMAScript 6, modules are included in the syntax of the
language. Now, in my `app/scripts/drforna.js` file I can simply do this:

```
import {FornaContainer} from 'fornac';

var container = new FornaContainer();
```

Fantastic! But how does Dr. Forna know where to find `fornac`? Well, since
it's not a path, then it must be a package. If it's a package, then it must
be either in the `node_modules` or the `bower_components` folder. In order
for it to be found there, it needs to be installed using either `bower` or
`npm`. Fortunately, I had just installed the `fornac` module using:

```
npm install  /home/mescalin/pkerp/projects/fornac
```

The file `node_modules/fornac/package.js` contains a line specifying the
entry point for the package:

```
  "main": "dist/scripts/fornac.js",
```

### The package provider (fornac)

## RNAutils

In `webpack.config.js`:

* Change the entry line to:

  entry: {rnautils: ['./scripts/rnautils.js']}

This allows for multiple entry points.

* Change the `name`, `version`, `description`, `main`, and `repository` in `package.json`

* `gulp build`
* `npm publish`
* `mversion patch -m` - Bump the version number and push the tag to github

Now in Fornac or Dr. Forna, install the package:

npm install /home/mescalin/pkerp/projects/rnautils

or...

npm install rnautils


